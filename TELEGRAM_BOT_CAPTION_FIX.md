# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò "Message caption is too long"

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ QR-–∫–æ–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:

```
Message caption is too long
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

Telegram **–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É caption** (–ø–æ–¥–ø–∏—Å–∏ –∫ —Ñ–æ—Ç–æ) –¥–æ **1024 —Å–∏–º–≤–æ–ª–æ–≤**.

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ caption –≤–∫–ª—é—á–∞–ª:
- –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
- –ö–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤

–í—Å–µ —ç—Ç–æ –≤–º–µ—Å—Ç–µ –º–æ–≥–ª–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å –ª–∏–º–∏—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏:
- –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –±—ã–ª–æ –¥–ª–∏–Ω–Ω—ã–º
- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –±—ã–ª–æ –ø–æ–¥—Ä–æ–±–Ω—ã–º
- –ö–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±—ã–ª –¥–ª–∏–Ω–Ω—ã–º UUID

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–†–∞–∑–¥–µ–ª–∏—Ç—å QR-–∫–æ–¥ –∏ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ **–¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è**:

1. **–ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** - —Ñ–æ—Ç–æ QR-–∫–æ–¥–∞ —Å –∫–æ—Ä–æ—Ç–∫–∏–º caption
2. **–í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** - –ø–æ–¥—Ä–æ–±–Ω–∞—è —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –í —Ñ–∞–π–ª–µ `backend/telegram_bot/bot_admin.py`:

#### ‚ùå –î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):

```python
# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º QR-–∫–æ–¥
qr_buffer.seek(0)
await update.message.reply_photo(
    photo=qr_buffer,
    caption=(
        "‚úÖ <b>–ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞!</b>\n\n"
        f"üé¥ –ù–∞–∑–≤–∞–Ω–∏–µ: <b>{verified_card.card_name}</b>\n"
        f"üîë –ö–æ–¥: <code>{verified_card.verification_code}</code>\n\n"
        "üì± <b>QR-–∫–æ–¥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!</b>\n\n"
        "üñ®Ô∏è <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:</b>\n"
        "1. –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ —ç—Ç–æ—Ç QR-–∫–æ–¥\n"
        "2. –ù–∞–∫–ª–µ–π—Ç–µ QR –Ω–∞ –∫–µ–π—Å —Å –∫–∞—Ä—Ç–æ–π\n"
        "3. –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ —É–ø–∞–∫–æ–≤–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É\n\n"
        "üì∏ <b>–®–∞–≥ 4/4: –§–æ—Ç–æ —É–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã</b>\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –∫–∞—Ä—Ç—ã —Å –Ω–∞–∫–ª–µ–µ–Ω–Ω—ã–º QR-–∫–æ–¥–æ–º\n"
        "–ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /skip –µ—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ",
    ),
    parse_mode='HTML'
)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–µ—Å—å —Ç–µ–∫—Å—Ç –≤ –æ–¥–Ω–æ–º caption - –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å 1024 —Å–∏–º–≤–æ–ª–∞.

---

#### ‚úÖ –ü–û–°–õ–ï (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):

```python
# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º QR-–∫–æ–¥ —Å –∫–æ—Ä–æ—Ç–∫–∏–º caption
qr_buffer.seek(0)
await update.message.reply_photo(
    photo=qr_buffer,
    caption=f"üì± QR-–∫–æ–¥ –¥–ª—è –∫–∞—Ä—Ç—ã: {verified_card.card_name}"
)

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
await update.message.reply_text(
    "‚úÖ <b>–ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞!</b>\n\n"
    f"üé¥ –ù–∞–∑–≤–∞–Ω–∏–µ: <b>{verified_card.card_name}</b>\n"
    f"üîë –ö–æ–¥: <code>{verified_card.verification_code}</code>\n\n"
    "üñ®Ô∏è <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:</b>\n"
    "1. –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ —ç—Ç–æ—Ç QR-–∫–æ–¥\n"
    "2. –ù–∞–∫–ª–µ–π—Ç–µ QR –Ω–∞ –∫–µ–π—Å —Å –∫–∞—Ä—Ç–æ–π\n"
    "3. –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ —É–ø–∞–∫–æ–≤–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É\n\n"
    "üì∏ <b>–®–∞–≥ 4/4: –§–æ—Ç–æ —É–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã</b>\n\n"
    "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –∫–∞—Ä—Ç—ã —Å –Ω–∞–∫–ª–µ–µ–Ω–Ω—ã–º QR-–∫–æ–¥–æ–º\n"
    "–ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /skip –µ—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ",
    parse_mode='HTML'
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ Caption –∫–æ—Ä–æ—Ç–∫–∏–π - –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç –ª–∏–º–∏—Ç
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ (–ª–∏–º–∏—Ç 4096 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ –õ—É—á—à–µ —á–∏—Ç–∞–µ—Ç—Å—è - QR-–∫–æ–¥ –∏ —Ç–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω—ã

---

## üìä –õ–∏–º–∏—Ç—ã Telegram

| –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ |
|-------------|-------------------|
| Caption (–ø–æ–¥–ø–∏—Å—å –∫ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ) | 1024 —Å–∏–º–≤–æ–ª–∞ |
| Text message (—Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ) | 4096 —Å–∏–º–≤–æ–ª–æ–≤ |
| Button text (—Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏) | 64 —Å–∏–º–≤–æ–ª–∞ |
| Command (–∫–æ–º–∞–Ω–¥–∞) | 32 —Å–∏–º–≤–æ–ª–∞ |

**–ò—Å—Ç–æ—á–Ω–∏–∫:** [Telegram Bot API Documentation](https://core.telegram.org/bots/api)

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–µ captions**

–î–ª—è —Ñ–æ—Ç–æ –∏ –º–µ–¥–∏–∞ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π caption:

```python
# ‚úÖ –•–û–†–û–®–û - –∫–æ—Ä–æ—Ç–∫–∏–π caption
await update.message.reply_photo(
    photo=image,
    caption="üì∏ –ö–∞—Ä—Ç–∞ Spider-Man #1"
)

# ‚ùå –ü–õ–û–•–û - –¥–ª–∏–Ω–Ω—ã–π caption
await update.message.reply_photo(
    photo=image,
    caption="üì∏ –ö–∞—Ä—Ç–∞ Spider-Man #1\n\n–û–ø–∏—Å–∞–Ω–∏–µ...[–µ—â–µ 500 —Å–∏–º–≤–æ–ª–æ–≤]..."
)
```

### 2. **–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ**

```python
# –°–Ω–∞—á–∞–ª–∞ —Ñ–æ—Ç–æ —Å –∫–æ—Ä–æ—Ç–∫–∏–º caption
await update.message.reply_photo(photo=image, caption="üì∏ –ö–∞—Ä—Ç–∞")

# –ó–∞—Ç–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
await update.message.reply_text("–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ...")
```

### 3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–ª–∏–Ω—É –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π**

–î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:

```python
caption = f"üì± QR-–∫–æ–¥: {card_name}"

# –û–±—Ä–µ–∑–∞–µ–º –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
if len(caption) > 1000:  # –û—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø–∞—Å
    caption = caption[:997] + "..."

await update.message.reply_photo(photo=qr, caption=caption)
```

### 4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥—Ä—É–ø–ø—ã –º–µ–¥–∏–∞**

–î–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ç–æ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏:

```python
media = [
    InputMediaPhoto(media=photo1, caption="–§–æ—Ç–æ 1"),
    InputMediaPhoto(media=photo2, caption="–§–æ—Ç–æ 2"),
]
await update.message.reply_media_group(media=media)

# –û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ
await update.message.reply_text("–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±–æ–∏—Ö —Ñ–æ—Ç–æ...")
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. **–î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç—É —Å –¥–ª–∏–Ω–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º**:
   ```
   /admin ‚Üí –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É
   –ù–∞–∑–≤–∞–Ω–∏–µ: "Spider-Man Amazing Fantasy #15 CGC 9.8 White Pages 1962 First Appearance"
   –û–ø–∏—Å–∞–Ω–∏–µ: [–î–ª–∏–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ 500+ —Å–∏–º–≤–æ–ª–æ–≤]
   ```
   
   ‚úÖ –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å - QR-–∫–æ–¥ –∏ —Ç–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω—ã

2. **–î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç—É —Å –∫–æ—Ä–æ—Ç–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º**:
   ```
   –ù–∞–∑–≤–∞–Ω–∏–µ: "Card 1"
   –û–ø–∏—Å–∞–Ω–∏–µ: "Test"
   ```
   
   ‚úÖ –¢–æ–∂–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –û—à–∏–±–∫–∞ "Message caption is too long"
- ‚ùå QR-–∫–æ–¥ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- ‚ùå –ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ QR-–∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∫–æ—Ä–æ—Ç–∫–∏–º caption
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–π –¥–ª–∏–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è/–æ–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ –õ—É—á—à–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∞

---

## üöÄ –°—Ç–∞—Ç—É—Å

**–ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω:** ‚úÖ –î–∞  
**PID:** 11143  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ:** ‚úÖ –î–∞  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç—É

---

## üîÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –î–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
caption = f"üì± <b>QR-–∫–æ–¥</b>: {verified_card.card_name}"
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Markdown –≤–º–µ—Å—Ç–æ HTML:

```python
caption = f"üì± *QR-–∫–æ–¥*: {verified_card.card_name}"
parse_mode='Markdown'
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Ä–æ–±–Ω–µ–µ":

```python
keyboard = [[InlineKeyboardButton("üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ", callback_data=f"details_{card_id}")]]
reply_markup = InlineKeyboardMarkup(keyboard)

await update.message.reply_photo(
    photo=qr,
    caption="üì± QR-–∫–æ–¥",
    reply_markup=reply_markup
)
```

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 17 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.3  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –†–ê–ë–û–¢–ê–ï–¢

